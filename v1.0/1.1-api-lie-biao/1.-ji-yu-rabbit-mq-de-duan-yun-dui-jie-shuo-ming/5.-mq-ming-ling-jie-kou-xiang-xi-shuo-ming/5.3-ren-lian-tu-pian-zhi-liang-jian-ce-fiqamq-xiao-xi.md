# 5.3 人脸图片质量检测（FIQA）MQ消息

**功能描述:**用于对图片进行多维度的质量检测。



<table>
  <thead>
    <tr>
      <th style="text-align:left"><b>&#x4E00;&#x7EA7;&#x53C2;&#x6570;</b>
      </th>
      <th style="text-align:left"><b>&#x4E8C;&#x7EA7;&#x53C2;&#x6570;</b>
      </th>
      <th style="text-align:left"><b>&#x7C7B;&#x578B;</b>
      </th>
      <th style="text-align:left"><b>&#x9009;&#x62E9;</b>
      </th>
      <th style="text-align:left"><b>&#x8BF4;&#x660E;</b>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">method</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">fiqa</td>
    </tr>
    <tr>
      <td style="text-align:left">messageId</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">MQ&#x6D88;&#x606F;&#x7684;&#x552F;&#x4E00;&#x6807;&#x8BC6;ID</td>
    </tr>
    <tr>
      <td style="text-align:left">info</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">dict</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x5305;&#x542B;&#x56FE;&#x7247;&#x6570;&#x636E;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">image_base64_str</td>
      <td style="text-align:left">string</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x56FE;&#x7247;base64&#x8F6C;&#x6362;&#x683C;&#x5F0F;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">fiqa_level</td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;&#xFF0C;&#x53EF;&#x4E3A;&#x7A7A;</td>
      <td style="text-align:left">&#x8D28;&#x91CF;&#x68C0;&#x6D4B;&#x7EA7;&#x522B;&#xFF0C;&#x5171;high&#xFF0C;custom,
        middle&#xFF0C;low&#xFF0C;no 5&#x4E2A;&#x7EA7;&#x522B;&#xFF0C;&#x9ED8;&#x8BA4;&#x4E3A;high</td>
    </tr>
    <tr>
      <td style="text-align:left">extend_params</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">dict</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x6269;&#x5C55;&#x5B57;&#x6BB5;&#xFF0C;&#x53EF;&#x4EE5;&#x4E3A;&#x7A7A;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">notify_path</td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">
        <p>&#x7BA1;&#x7406;&#x5E73;&#x53F0;URL&#xFF08;&#x76F8;&#x5BF9;&#x5730;&#x5740;&#xFF09;&#xFF0C;&#x7528;&#x4E8E;&#x901A;&#x8FC7;http&#x65B9;&#x5F0F;&#x56DE;&#x4F20;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x3002;
          &#x76F8;&#x5BF9;&#x5730;&#x5740;&#x7684;&#x7EC4;&#x5408;&#x8BF7;&#x53C2;&#x89C1;
          URL&#x7EC4;&#x5408;&#x7AE0;&#x8282;&#x3002;</p>
        <p>&#x6CE8;&#x610F;&#xFF1A;</p>
        <p>&#x5982;&#x679C;&#x767B;&#x9646;&#x65F6;&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x4E0B;&#x53D1;
          uploadQueue &#x5B57;&#x6BB5;&#xFF0C;&#x5219;&#x4F1A;&#x901A;&#x8FC7;MQ&#x4E0A;&#x4F20;&#x901A;&#x9053;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;</p>
        <p>&#x5982;&#x679C;&#x6CA1;&#x6709; uploadQueue &#x5B57;&#x6BB5;&#xFF0C;&#x5E76;&#x4E14;
          notify_path &#x4E3A;&#x975E;&#x7A7A;&#xFF0C;&#x5219;&#x4F1A;&#x5411; notify_path
          &#x8FD4;&#x56DE;&#x7ED3;&#x679C;</p>
        <p>&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x5B57;&#x6BB5;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF08;&#x5373;&#x5355;&#x5411;&#x901A;&#x4FE1;&#xFF09;&#x3002;</p>
      </td>
    </tr>
  </tbody>
</table>**MQ命令示例：**

```text
{
	"method": "fiqa", // 此关键字和内容不能变
    "messageId":"adjfqk34j5l2h3loadshfl",  //MQ消息的唯一标识ID
	"info":{
		"image_base64_str":"xxxx",  //base64格式图片数据
		"fiqa_level":"high"   //质量检测级别，默认为high
	}

	"extend_params": {
			"notify_path": "URL" // 返回mq命令处理结果的地址
    }  // 扩展字段，当前为空。用于将来的接口升级。扩展字段的内容以字典的形式填充，但扩展字段本身为必选。
	
}
```

**返回结果示例：**

```text
{
	"success":true，
    "code":0,
    "message":"检测图片质量MQ命令执行成功",
	"dev_sno":"sfgwe12341" ,//设备唯一标识key
	"messageKey":"fiqa" ,//每一类消息格式的key
    "messageId":"adjfqk34j5l2h3loadshfl",  //MQ消息的唯一标识ID
	"result":{
			"data":[{
				"bbox": [
                	103,
                	78,
               		514,
                	609
            	],
            	"fails": [],
            	"fiqa_result": true,
            	"info": {
                	"brightness": 0.9496459238842202,   //明暗度
                	"clarity": 1.4716458509372252,      //清晰度
                	"face_size": 354,                   //人脸大小
                	"headpose": {                       //人脸角度
                    	"pitch_angle": 9.38,
                    	"roll_angle": -0.05,
                    	"yaw_angle": -1.63
                		},
                	"mask": 0.0036406677681952715,       
                	"occlusion": [
                    	true,
                    	true,
                    	true
                		],
                	"partial": false
            	},
            	"score": 1.4716458509372252,
            	"success": [
                	"face_size",
                	"headpose",
                	"occlusion",
                	"clarity",
                	"mask",
                	"partial",
                	"brightness"
            	]， 
			} ]                                                                                  
	}
}
```



