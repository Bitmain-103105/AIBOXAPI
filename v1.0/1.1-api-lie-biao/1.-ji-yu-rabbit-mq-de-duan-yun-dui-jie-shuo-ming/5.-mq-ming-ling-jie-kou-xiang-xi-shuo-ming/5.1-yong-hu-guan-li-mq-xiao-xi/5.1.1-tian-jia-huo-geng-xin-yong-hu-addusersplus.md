# 1.5.1.1 添加或更新用户（add\_users\_plus）

**功能描述：**

此命令用于管理平台向 SE3 AI 迷你机下发用户列表和用户详细信息请求URL。SE3 AI 迷你机的默认行为是创建并添加新用户，但如果用户ID已经存在，则会覆盖已有的用户信息。

为提升系统性能，管理平台一般只下发用户ID列表和获取用户详细信息的URL，SE3 AI 迷你机在收到用户列表后，会根据这两个字段组合出获取用户详细信息的实际URL。如何组合实际URL，请参见 URL组合章节。

| **一级参数** | **二级参数** | **三级参数** | **类型** | **选择** | **说明** |
| :--- | :--- | :--- | :--- | :--- | :--- |

| method |  |  | string | 必选 | add\_users\_plus |
| :--- | :--- | :--- | :--- | :--- | :--- |

| messageId |  |  | string | 可选 | MQ消息的唯一标识ID |
| :--- | :--- | :--- | :--- | :--- | :--- |


<table>
  <thead>
    <tr>
      <th style="text-align:left">userid_list</th>
      <th style="text-align:left"></th>
      <th style="text-align:left"></th>
      <th style="text-align:left">list</th>
      <th style="text-align:left">&#x5FC5;&#x9009;&#xFF0C;&#x4E8C;&#x9009;&#x4E00;</th>
      <th style="text-align:left">
        <p>&#x7528;&#x6237;&#x4FE1;&#x606F;ID&#x5217;&#x8868;&#xFF0C;&#x7BA1;&#x7406;<b>&#x5E73;&#x53F0;&#x9700;&#x8981;&#x4FDD;&#x8BC1;&#x7528;&#x6237;ID&#x552F;&#x4E00;&#xFF1B;</b>
        </p>
        <p><b>&#x9ED8;&#x8BA4;&#x884C;&#x4E3A;&#x662F;&#x521B;&#x5EFA;&#x5E76;&#x6DFB;&#x52A0;&#x65B0;&#x7528;&#x6237;&#xFF0C;&#x4F46;&#x5982;&#x679C;&#x7528;&#x6237;ID&#x5DF2;&#x7ECF;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x4F1A;&#x8986;&#x76D6;&#x5DF2;&#x6709;&#x7684;&#x4FE1;&#x606F;&#x3002;</b>
        </p>
      </th>
    </tr>
  </thead>
  <tbody></tbody>
<<<<<<< HEAD
</table>| user\_info\_list |  |  | list | 必选，二选一 | 用户信息列表，不只下发ID信息，还有其他基础信息，下发基础信息和通过http协议得内容一致，字段定义详情请看人员下发信息接口。 |
| :--- | :--- | :--- | :--- | :--- | :--- |

| extend\_params |  |  | dict | 必选 | 扩展字段，可以为空 |
=======
</table>| extend\_params |  |  | dict | 必选 | 扩展字段，可以为空 |
>>>>>>> 7af6526779f4d88244c5298f29eb8f7e148c089a
| :--- | :--- | :--- | :--- | :--- | :--- |


<table>
  <thead>
    <tr>
      <th style="text-align:left"></th>
      <th style="text-align:left">path</th>
      <th style="text-align:left"></th>
      <th style="text-align:left">string</th>
      <th style="text-align:left">&#x53EF;&#x9009;</th>
      <th style="text-align:left">
        <p>&#x83B7;&#x53D6;&#x4EBA;&#x5458;&#x8BE6;&#x7EC6;&#x4FE1;&#x606F;&#x7684;URL&#xFF1A;</p>
        <p>a. &#x7EDD;&#x5BF9;&#x5730;&#x5740;&#xFF1A;&#x5FC5;&#x7136;&#x52A0;&#x4E0A;&#x534F;&#x8BAE;&#xFF0C;&#x4EE5;http&#x6216;&#x8005;https&#x5F00;&#x5934;</p>
        <p>b. &#x76F8;&#x5BF9;&#x5730;&#x5740;&#xFF1A;&#x4EE5;&quot;/&quot;&#x5F00;&#x59CB;&#xFF0C;&#x52A0;&#x4E0A;&#x63A5;&#x53E3;&#x540D;&#x3002;&#x5982;
          /getUserInfo&#x3002;</p>
        <p>&#x6CE8;&#x610F;&#xFF1A;</p>
        <p>&#x82E5;&#x4EBA;&#x5458;&#x4FE1;&#x606F;&#x901A;&#x8FC7;user_info_list&#x4E2D;&#x4E0B;&#x53D1;&#xFF0C;&#x5219;&#x6B64;path&#x65E0;&#x610F;&#x4E49;&#x3002;</p>
      </th>
    </tr>
  </thead>
  <tbody></tbody>
</table><table>
  <thead>
    <tr>
      <th style="text-align:left"></th>
      <th style="text-align:left">notify_path</th>
      <th style="text-align:left"></th>
      <th style="text-align:left">string</th>
      <th style="text-align:left">&#x53EF;&#x9009;</th>
      <th style="text-align:left">
        <p>&#x7BA1;&#x7406;&#x5E73;&#x53F0;URL&#xFF08;&#x76F8;&#x5BF9;&#x5730;&#x5740;&#xFF09;&#xFF0C;&#x7528;&#x4E8E;&#x901A;&#x8FC7;http&#x65B9;&#x5F0F;&#x56DE;&#x4F20;&#x547D;&#x4EE4;&#x6267;&#x884C;&#x7ED3;&#x679C;&#x3002;
          &#x76F8;&#x5BF9;&#x5730;&#x5740;&#x7684;&#x7EC4;&#x5408;&#x8BF7;&#x53C2;&#x89C1;
          URL&#x7EC4;&#x5408;&#x7AE0;&#x8282;&#x3002;</p>
        <p>&#x6CE8;&#x610F;&#xFF1A;</p>
        <p>&#x5982;&#x679C;&#x767B;&#x9646;&#x65F6;&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x4E0B;&#x53D1;
          uploadQueue &#x5B57;&#x6BB5;&#xFF0C;&#x5219;&#x4F1A;&#x901A;&#x8FC7;MQ&#x4E0A;&#x4F20;&#x901A;&#x9053;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;</p>
        <p>&#x5982;&#x679C;&#x6CA1;&#x6709; uploadQueue &#x5B57;&#x6BB5;&#xFF0C;&#x5E76;&#x4E14;
          notify_path &#x4E3A;&#x975E;&#x7A7A;&#xFF0C;&#x5219;&#x4F1A;&#x5411; notify_path
          &#x8FD4;&#x56DE;&#x7ED3;&#x679C;</p>
        <p>&#x5982;&#x679C;&#x4E24;&#x4E2A;&#x5B57;&#x6BB5;&#x90FD;&#x6CA1;&#x6709;&#xFF0C;&#x5219;&#x4E0D;&#x4F1A;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#xFF08;&#x5373;&#x5355;&#x5411;&#x901A;&#x4FE1;&#xFF09;&#x3002;</p>
      </th>
    </tr>
  </thead>
  <tbody></tbody>
</table>```text
#如下是下发人员id列表的话，则人员的基础信息则通过path中的获取人员信息接口获取其他基础信息 
{
    "method": "add_users_plus", // 此关键字和内容不能变
    "userid_list": ["user_id1","user_id2"]， // 人员id列表
    "extend_params":   // 扩展字段，当前为空。用于将来的接口升级。扩展字段的内容以字典的形式填充，但扩展字段本身为必选。
    { 
        "path": "URL"// 获取用户信息的接口的URL前缀
        "notify_path": "URL" // 此处选择通过http协议返回mq命令处理结果的地址
    }  
}
```

使用 user\_info\_list 的形式直接下发人员信息：

```text
{
    "method": "add_users_plus", // 此关键字和内容不能变

    "user_info_list":  // 人员数据列表
         [
            {
             "info":
                   {
                     "name":"fubing",   //人员名称
                     "type":1     //人员类型
                   },

            "identity_id":"666",   //人员id
            "reg_url":"http://xxxx.png"  //图片地址
            },
            {
             "info":
                   {
                     "permission_ids":["1046"], //设备权限组列表
                     "name":"wuyanzu",   //人员名称
                     "type":1     //人员类型
                   },

            "identity_id":"888",   //人员id
            "reg_url":"http://xxxx.png"  //图片地址
            },

        ]，
    "extend_params":   // 扩展字段，当前为空。用于将来的接口升级。扩展字段的内容以字典的形式填充，但扩展字段本身为必选。
    { 
    }  
}
```

**返回结果示例：**

```text
{
    "success":true，
    "code":0,
    "message":"下发人员MQ命令执行成功"
    "dev_sno":"sda23erasd" ,//设备唯一标识key
    "messageKey":"add_users_plus", //每一类消息格式的key
    "result":{
        "success_users":[
                 {"userid":"12365", "username":"小赵","message":"人员下发成功"，"code":0}
         ] ，                                                                        //下发成功的人员
        "failed_users":[
                {"userid":"12366", "username":"小王","message":"无法检测到人脸", "code":"40094"},   //插入失败的人员
                {"userid":"12367", "username":"小明","message":"无法检测到人脸,  "code":"40094"}
        ]

}
```

