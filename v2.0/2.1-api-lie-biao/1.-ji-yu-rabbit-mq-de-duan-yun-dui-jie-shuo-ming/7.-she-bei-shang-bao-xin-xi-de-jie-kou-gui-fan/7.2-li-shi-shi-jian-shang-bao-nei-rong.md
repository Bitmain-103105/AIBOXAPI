# 1.7.2 历史事件上报内容

**功能描述**

上报所有事件（数据库保存所有Event字段）给云平台。需要和监控服务器约定url，假设/EventServer/api/HistoryEvent 

**调用URL**

调用方法: POST

**参数描述（JSON格式）：**

<table>
  <thead>
    <tr>
      <th style="text-align:left">index</th>
      <th style="text-align:left">&#x4E00;&#x7EA7;&#x53C2;&#x6570;</th>
      <th style="text-align:left">&#x4E8C;&#x7EA7;&#x53C2;&#x6570;</th>
      <th style="text-align:left">&#x7C7B;&#x578B;</th>
      <th style="text-align:left">&#x9009;&#x62E9;</th>
      <th style="text-align:left">&#x8BF4;&#x660E;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">1</td>
      <td style="text-align:left">identity_id</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x7528;&#x6237;&#x7F16;&#x53F7;</td>
    </tr>
    <tr>
      <td style="text-align:left">2</td>
      <td style="text-align:left">identity_name</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x7528;&#x6237;&#x540D;&#x79F0;</td>
    </tr>
    <tr>
      <td style="text-align:left">3</td>
      <td style="text-align:left">group_name</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x6BD4;&#x5BF9;&#x7684;group name&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x6709;group_name&#x8FD4;&#x56DE;group_id</td>
    </tr>
    <tr>
      <td style="text-align:left">4</td>
      <td style="text-align:left">reg_pic</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">base64</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x6CE8;&#x518C;&#x7684;&#x4EBA;&#x8138;&#x5E95;&#x5E93;&#xFF0C;&#x53EF;&#x914D;&#x7F6E;&#x53BB;&#x9664;</td>
    </tr>
    <tr>
      <td style="text-align:left">5</td>
      <td style="text-align:left">timestamp</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">int32</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x4E8B;&#x4EF6;&#x53D1;&#x751F;&#x7684;&#x65F6;&#x95F4;&#x6233;</td>
    </tr>
    <tr>
      <td style="text-align:left">6</td>
      <td style="text-align:left">score</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">float</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x6BD4;&#x5BF9;&#x7684;&#x5206;&#x6570;</td>
    </tr>
    <tr>
      <td style="text-align:left">7</td>
      <td style="text-align:left">ext_data</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">dict</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x62D3;&#x5C55;&#x6570;&#x636E;&#x5B57;&#x6BB5;&#xFF0C;&#x53EF;&#x8FED;&#x4EE3;&#x6DFB;&#x52A0;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">device_ip</td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x8BBE;&#x5907;ip</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">ep_id</td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">
        <p>&#x8FB9;&#x7F18;&#x8282;&#x70B9;ID&#xFF0C;&#x662F;&#x6307;SE3 AI&#x8FF7;&#x4F60;&#x673A;&#x8FDE;&#x63A5;&#x7684;&#x91C7;&#x96C6;&#x8BBE;&#x5907;&#x7684;ID&#x3002;</p>
        <p>ID&#xFF1A;dev_sno&#x548C;IP&#x7684;&#x7EC4;&#x5408;&#xFF0C;&#x7528;&#x53CC;&#x4E0B;&#x5212;&#x7EBF;&#x505A;&#x8FDE;&#x63A5;&#x3002;&#x4E3E;&#x4F8B;&#xFF1A;AKOPKKKKK__192.168.1.25</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">spot_pic</td>
      <td style="text-align:left">base64</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x73B0;&#x573A;&#x7167;&#x7247;&#xFF0C;&#x53EF;&#x914D;&#x7F6E;&#x662F;&#x5426;&#x4E3A;&#x5927;&#x56FE;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">person_type</td>
      <td style="text-align:left">int</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">
        <p>1:&#x5458;&#x5DE5;&#xFF08;&#x9ED8;&#x8BA4;&#x4E3A;&#x5458;&#x5DE5;&#xFF0C;&#x5305;&#x62EC;&#x8FD9;&#x4E2A;&#x5B57;&#x6BB5;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x60C5;&#x51B5;&#xFF09;</p>
        <p>2: &#x8BBF;&#x5BA2;</p>
        <p>3: &#x9ED1;&#x540D;&#x5355;</p>
        <p>4&#xFF1A;&#x964C;&#x751F;&#x4EBA;</p>
        <p>5&#xFF1A;VIP</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">device_type</td>
      <td style="text-align:left">strin</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">
        <p>0&#xFF1A;&#x95F8;&#x673A;&#xFF0C;</p>
        <p>1&#xFF1A;&#x6293;&#x62CD;&#x673A;</p>
        <p>2&#xFF1A;IPC &#x9759;&#x6001;</p>
        <p>3&#xFF1A;IPC &#x52A8;&#x6001;</p>
        <p>4&#xFF1A;&#x95E8;&#x7981;</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">grab_fiqa_info</td>
      <td style="text-align:left">dict</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x8FD4;&#x56DE;&#x6293;&#x62CD;&#x673A;&#x5F97;&#x4EBA;&#x8138;&#x8D28;&#x91CF;&#x68C0;&#x6D4B;&#x7ED3;&#x679C;&#xFF0C;&#x8BE6;&#x7EC6;&#x8BF7;&#x770B;&#x793A;&#x4F8B;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">box_fiqa_info</td>
      <td style="text-align:left">dict</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">&#x8FD4;&#x56DE;AI BOX&#x5F97;&#x4EBA;&#x8138;&#x8D28;&#x91CF;&#x68C0;&#x6D4B;&#x7ED3;&#x679C;&#xFF0C;&#x8BE6;&#x7EC6;&#x8BF7;&#x770B;&#x793A;&#x4F8B;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">dev_sno</td>
      <td style="text-align:left">string</td>
      <td style="text-align:left"><b>&#x5FC5;&#x9009;</b>
      </td>
      <td style="text-align:left">SE3 AI&#x8FF7;&#x4F60;&#x673A;&#x552F;&#x4E00;&#x6807;&#x8BC6;&#x6388;&#x6743;&#x7801;</td>
    </tr>
  </tbody>
</table>**返回信息：**

```text
{
	'score': 0.16, 
	'reg_pic': '', 
	'group_name': 'default_group', 
	'identity_id': '13028', 
	'identity_name': 'stranger', 
	'timestamp': 1560408984678, 
	'ext_data': {
			'device_type': '1', 
			'grab_fiqa_info': {   //臻识抓拍机返回的信息
					'confidence': 90, 
					'face_id': 1381, 
					'rect': {'top': 420, 'bottom': 524, 'right': 1734, 'left': 1652}, 
					'pitch': 0, 
					'age': 4, 
					'rel_rect': {'top': 62, 'bottom': 166, 'right': 134, 'left': 52}, 
					'yaw': 0, 
					'eye_dist': 82, 
					'roll': 0, 
					'sex': 1}, //性别0为男， 1为女
			'spot_pic': 'xxxxx', 
			'box_fiqa_info': {   //AI BOX端返回的图片质量检测信息
					'age':4,
					'sex':1, //性别0为男，1为女
					'info': {'face_size': 255.0, 'clarity': 1.285613331998212, 'headpose': {'roll_angle': 10.107, 'pitch_angle': 14.413, 'yaw_angle': 7.326}, 'partial': False, 'brightness': 0.8362176798557405},  //图片质量检测的参数
					'fiqa_result': True,    //fiqa是否合格的标志，True表示图片质量比较好
					'success': ['face_size', 'clarity', 'headpose', 'partial', 'brightness'], 
					'fails': []}, 
			'person_type': 1,   //通过此处的人员类型来判断是否是陌生人，如果是person_type为4， 则是陌生人，且fiqa_result为False，则说明陌生人的图片质量不是很好，不能进行再次下发注册
			 'device_ip': '192.168.1.151'}
}
```

**示例：**

可以使用小盒子附带的server来获取上传的事件。

假设小盒子的ip为：192.168.1.19，接收的resetful api为HistoryEvent ，端口号为9528。

那webui或是配置/修改历史事件上报接收服务器地址信息为：[http://192.168.1.19:9528/HistoryEvent](http://192.168.1.19:9528/RealTimeEvent)

启动server方法：

```text
$ sudo -i
# cd /system/data/sophon_gate/script
# python3 Event_Receive_server.py

* Serving Flask app "Event_Receive_server" (lazy loading)
* Environment: production
WARNING: Do not use the development server in a production environment.
Use a production WSGI server instead.
* Debug mode: off
* Running on http://0.0.0.0:9528/ (Press CTRL+C to quit)
```

\*\*\*\*

\*\*\*\*

<table>
  <thead>
    <tr>
      <th style="text-align:left">&#x4E00;&#x7EA7;&#x53C2;&#x6570;</th>
      <th style="text-align:left">&#x4E8C;&#x7EA7;&#x53C2;&#x6570;</th>
      <th style="text-align:left">&#x4E09;&#x7EA7;&#x53C2;&#x6570;</th>
      <th style="text-align:left">&#x7C7B;&#x578B;</th>
      <th style="text-align:left">&#x9009;&#x62E9;</th>
      <th style="text-align:left">&#x63CF;&#x8FF0;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">gateway_ip</td>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">SE3 AI&#x8FF7;&#x4F60;&#x673A;&#x7684; IP &#x5730;&#x5740;</td>
    </tr>
    <tr>
      <td style="text-align:left">gateway_name</td>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">SE3 AI&#x8FF7;&#x4F60;&#x673A;&#x521D;&#x59CB;&#x5316;&#x65F6;&#x7684;&#x4E3B;&#x673A;&#x540D;</td>
    </tr>
    <tr>
      <td style="text-align:left">gateway_status</td>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">
        <p>SE3 AI&#x8FF7;&#x4F60;&#x673A;&#x72B6;&#x6001;</p>
        <p>online&#xFF1A;</p>
        <p>offline&#xFF1A;</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">gateway_sn</td>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">SE3 AI&#x8FF7;&#x4F60;&#x673A;&#x786C;&#x4EF6;SN&#x7F16;&#x7801;</td>
    </tr>
    <tr>
      <td style="text-align:left">dev_sno</td>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">SE3 AI&#x8FF7;&#x4F60;&#x673A;&#x767B;&#x5F55;&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x7528;&#x7684;&#x6388;&#x6743;&#x7801;&#xFF08;&#x7531;&#x7BA1;&#x7406;&#x5E73;&#x53F0;&#x751F;&#x6210;&#xFF09;</td>
    </tr>
    <tr>
      <td style="text-align:left">gateway_ext_data</td>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">dict</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">&#x989D;&#x5916;&#x4FE1;&#x606F;&#x5B57;&#x6BB5;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">sw_version</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x4E2D;&#x5FC3;&#x8282;&#x70B9;&#x7248;&#x672C;&#x4FE1;&#x606F;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">sdk_version</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x7B97;&#x6CD5;&#x7248;&#x672C;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">gateway_mac</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">SE3 AI&#x8FF7;&#x4F60;&#x673A;Mac&#x5730;&#x5740;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">cpu_usage</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">float</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">CPU&#x4F7F;&#x7528;&#x7387;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">memory_size</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">float</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x5185;&#x5B58;&#x5927;&#x5C0F;&#xFF0C;&#x5355;&#x4F4D;GB</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">memory_usage</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">float</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x7387;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">disk_size</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">float</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x78C1;&#x76D8;&#x5927;&#x5C0F;&#xFF0C;&#x5355;&#x4F4D;GB(/data&#x5206;&#x533A;)</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">disk_free_size</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">float</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x78C1;&#x76D8;&#x6570;&#x636E;&#x5206;&#x533A;&#x5269;&#x4F59;&#x53EF;&#x7528;&#x7A7A;&#x95F4;&#xFF0C;&#x5355;&#x4F4D;&#x4E3A;GB(/data&#x5206;&#x533A;)</td>
    </tr>
    <tr>
      <td style="text-align:left">sub_devices</td>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
      <td style="text-align:left">list</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">&#x8BBE;&#x5907;&#x4FE1;&#x606F;&#x5217;&#x8868;</td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">ep_id</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">
        <p>&#x8FB9;&#x7F18;&#x8282;&#x70B9;ID&#xFF0C;&#x662F;&#x6307;SE3 AI&#x8FF7;&#x4F60;&#x673A;&#x8FDE;&#x63A5;&#x7684;&#x91C7;&#x96C6;&#x8BBE;&#x5907;&#x7684;ID&#x3002;</p>
        <p>ID&#xFF1A;dev_sno&#x548C;IP&#x7684;&#x7EC4;&#x5408;&#xFF0C;&#x7528;&#x53CC;&#x4E0B;&#x5212;&#x7EBF;&#x505A;&#x8FDE;&#x63A5;&#x3002;&#x4E3E;&#x4F8B;&#xFF1A;AKOPKKKKK__192.168.1.25</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">ep_name</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x6DFB;&#x52A0;&#x524D;&#x7AEF;&#x91C7;&#x96C6;&#x8BBE;&#x5907;&#x65F6;&#x8BBE;&#x7F6E;&#x7684;&#x8BBE;&#x5907;&#x63CF;&#x8FF0;&#x5B57;&#x7B26;&#x4E32;</td>
      <td
      style="text-align:left"></td>
    </tr>
    <tr>
      <td style="text-align:left">ep_ip</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">&#x8FB9;&#x7F18;&#x8282;&#x70B9;ip&#x5730;&#x5740;</td>
      <td style="text-align:left"></td>
    </tr>
    <tr>
      <td style="text-align:left">ep_status</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">&#x8FB9;&#x7F18;&#x8282;&#x70B9;&#x72B6;&#x6001;[online, offline]</td>
      <td
      style="text-align:left"></td>
    </tr>
    <tr>
      <td style="text-align:left">ep_location</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x6B64;&#x5B57;&#x6BB5;&#x88AB;&#x5E9F;&#x5F03;</td>
      <td style="text-align:left"></td>
    </tr>
    <tr>
      <td style="text-align:left">ep_type</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">
        <p>0&#xFF1A;&#x95F8;&#x673A;&#xFF0C;</p>
        <p>1&#xFF1A;&#x6293;&#x62CD;&#x673A;</p>
        <p>2&#xFF1A;IPC &#x9759;&#x6001;</p>
        <p>3&#xFF1A;IPC &#x52A8;&#x6001;</p>
        <p>4&#xFF1A;&#x95E8;&#x7981;</p>
      </td>
      <td style="text-align:left"></td>
    </tr>
    <tr>
      <td style="text-align:left">ep_ext_data</td>
      <td style="text-align:left"></td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x5FC5;&#x9009;</td>
      <td style="text-align:left">&#x8FB9;&#x7F18;&#x8282;&#x70B9;&#x5176;&#x4ED6;&#x4FE1;&#x606F;</td>
      <td
      style="text-align:left"></td>
    </tr>
    <tr>
      <td style="text-align:left"></td>
      <td style="text-align:left">sw_version</td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x8F6F;&#x4EF6;&#x7248;&#x672C;</td>
      <td style="text-align:left"></td>
    </tr>
    <tr>
      <td style="text-align:left">group_name</td>
      <td style="text-align:left">string</td>
      <td style="text-align:left">&#x53EF;&#x9009;</td>
      <td style="text-align:left">&#x6BD4;&#x5BF9;&#x7684;&#x5206;&#x7EC4;</td>
      <td style="text-align:left"></td>
      <td style="text-align:left"></td>
    </tr>
  </tbody>
</table>